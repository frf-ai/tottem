# Migration `20200512163203-first`

This migration has been generated by Vincent Poulain at 5/12/2020, 4:32:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "ItemType" AS ENUM ('book', 'album', 'movie', 'video', 'people', 'article', 'podcast', 'website', 'repository');

CREATE TABLE "public"."User" (
"authUserId" text   ,"biography" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"firstname" text  NOT NULL ,"github" text   ,"id" text  NOT NULL ,"label" text   ,"linkedin" text   ,"mail" text   ,"pictureUrl" text  NOT NULL ,"slug" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"website" text   ,"youtube" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Section" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"index" integer  NOT NULL DEFAULT 0,"isDeleted" boolean  NOT NULL DEFAULT false,"isExpanded" boolean  NOT NULL DEFAULT true,"name" text   ,"ownerId" text  NOT NULL ,"slug" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Collection" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"detail" text   ,"id" text  NOT NULL ,"isDeleted" boolean  NOT NULL DEFAULT false,"name" text   ,"ownerId" text  NOT NULL ,"sectionId" text  NOT NULL ,"slug" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Item" (
"author" text   ,"collectionId" text   ,"comment" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text   ,"id" text  NOT NULL ,"imageUrl" text   ,"inboxOwnerId" text   ,"isDeleted" boolean  NOT NULL DEFAULT false,"meta" text   DEFAULT '{}',"position" integer  NOT NULL DEFAULT 0,"productUrl" text   ,"provider" text   ,"title" text  NOT NULL ,"type" "ItemType" NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.authUserId" ON "public"."User"("authUserId")

CREATE UNIQUE INDEX "User.slug" ON "public"."User"("slug")

CREATE UNIQUE INDEX "Collection.slug" ON "public"."Collection"("slug")

ALTER TABLE "public"."Section" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Collection" ADD FOREIGN KEY ("sectionId")REFERENCES "public"."Section"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Collection" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Item" ADD FOREIGN KEY ("collectionId")REFERENCES "public"."Collection"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Item" ADD FOREIGN KEY ("inboxOwnerId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200512163203-first
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,90 @@
+generator photon {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model User {
+  id           String       @default(cuid()) @id
+  authUserId   String?      @unique
+  slug         String       @unique
+  createdAt    DateTime     @default(now())
+  updatedAt    DateTime     @updatedAt
+  firstname    String
+  pictureUrl   String
+  biography    String?
+  linkedin     String?
+  github       String?
+  mail         String?
+  youtube      String?
+  website      String?
+  label        String?
+  sections     Section[]
+  collections  Collection[]
+  inboxedItems Item[]
+}
+
+model Section {
+  id          String       @default(cuid()) @id
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+  slug        String
+  name        String?
+  index       Int          @default(0)
+  collections Collection[]
+  owner       User         @relation(fields: [ownerId], references: [id])
+  ownerId     String
+  isExpanded  Boolean      @default(true)
+  isDeleted   Boolean      @default(false)
+}
+
+model Collection {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  slug      String   @unique
+  name      String?
+  isDeleted Boolean  @default(false)
+  detail    String?
+  items     Item[]
+  section   Section  @relation(fields: [sectionId], references: [id])
+  sectionId String
+  owner     User     @relation(fields: [ownerId], references: [id])
+  ownerId   String
+}
+
+model Item {
+  id           String      @default(cuid()) @id
+  createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @updatedAt
+  isDeleted    Boolean     @default(false)
+  position     Int         @default(0)
+  title        String
+  provider     String?
+  author       String?
+  type         ItemType
+  productUrl   String?
+  imageUrl     String?
+  description  String?
+  comment      String?
+  collection   Collection? @relation(fields: [collectionId], references: [id])
+  collectionId String?
+  meta         String?     @default("{}")
+  inboxOwner   User?       @relation(fields: [inboxOwnerId], references: [id])
+  inboxOwnerId String?
+}
+
+enum ItemType {
+  book
+  album
+  movie
+  video
+  people
+  article
+  podcast
+  website
+  repository
+}
```
